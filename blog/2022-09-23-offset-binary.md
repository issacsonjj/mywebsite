---
slug: offset-binary
title: 偏移二进制码
authors: issacsonjj
tags: [偏移二进制, Offset Binary, Excess-K]
---

在读《自己动手实现Lua：虚拟机、编译器和标准库》时，看到Lua内部表示有符号整数使用的是不常见的偏移二进制码，有些陌生，特此记录。

### 定义

对于一个有符号数n，其偏移二进制表示的位模式（bit pattern）为n+K的无符号数，K称为偏移量（biasing value或offset），故该编码方式又称为Excess-K码。

偏移二进制没有标准，但最常见的，对于n位二进制表示的数，K = $2^{n-1}$。

对于8位表示的数，K = 128，典型数字的转换表如下：

|偏移二进制值|对应的原码值|位模式|
|---|---|---|
|-128|0|00000000|
|0|128|10000000|
|127|255|11111111|

仔细观察就会发现，只要把位模式的最高位取反，其补码值就是原来的值。


### 性质和应用

从转换表可以看到，全0表示最小的负值，全1表示最大的正数。想要比较两个数的大小，只要按位从高到低依次比较即可。相对于补码表示，你一眼就能看出两个数的大小。

当然，此特性主要不是为了加快目视比较的速度，而是方便DSP处理。大多数的AD芯片是单极性的，无法处理双极性信号。一个常用的解决方案是给模拟量添加一个相当于AD量程范围一半的偏置，这样就可以输出以偏移二进制码表示的结果了（学EE的同学，还记得逐次比较的ADC么？）。

至于为何Lua在指令时要使用此编码，有点百思不得其解。


### 参考

- [维基百科](https://en.wikipedia.org/wiki/Offset_binary)
- 《自己动手实现Lua：虚拟机、编译器和标准库》